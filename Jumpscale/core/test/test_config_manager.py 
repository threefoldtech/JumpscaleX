from Jumpscale import j
from .base_test import BaseTest


class TestIConfigManager(BaseTest):
    def setUp(self):
        print("\t")
        self.info('Test case: {}'.format(self._testMethodName))

    def tearDown(self):
        pass

    def Test01_create_new_client(self):
        """
        TC198

        ** create new user with certain schema, should success **
           we will use IYO client as an example 

        #. Create new github client, and save it.
        #. Check the shema and make sure that the use is created successfully. 
        """

        self.info("Create github client and save it, should success")
        command = """. /sandbox/env.sh && echo 'c=j.clients.github.new("test_create_client", token="test_create_new_client"); 
                    c.save()' | jsx kosmos """
        output, error = self.os_command(command)
        self.info("Check that the client is created correctly")
        self.assertTrue(output)
        self.assertIn("- name                 : test_create_client", output.decode())
        self.info("Check that there is no error")
        self.assertFalse(error)

    def Test02_create_user_with_name_exists_before(self):
        """
        TC256

        ** create use with name exist before, should fail. **

        #. Create user with the same name as TC198. 
        #. Check the output, should fail. 
        """

        self.info("Create github user with test name, should fail.")
        command = """. /sandbox/env.sh && echo 'c=j.clients.github.new("test_create_client", token="test_create_new_client"); 
                  c.save()' | jsx kosmos """
        output, error = self.os_command(command)
        self.info("Check the creation of client is failed")
        self.assertTrue(error)
        self.assertIn("obj: test already exists", output.decode())

    def Test03_modify_exists_client(self):
        """
        TC195

        ** Test update user cleint data, should success ** 

        #. Update github "test_create_client" user token. 
        #. Check the updated token, should success. 
        """

        self.info("Update github user token")
        command = """. /sandbox/env.sh && echo 'c.token="test_update"); c.save()' | jsx kosmos """
        output, error = self.os_command(command)
        self.info(" check cleint token ")
        self.assertFalse(error)
        self.assertIn("- token                : test_update", output.decode())

    def Test04_test_delete_client_for_exists_cient(self):
        """
        TC196

        ** Test delete github client for exists client, should success. **

        #. Delete "test_create_client" github client.
        #. check that the client is deleted successfully.

        """

        self.info("Delete test github client")
        command = """. /sandbox/env.sh && echo 'c.delete("test_create_client"); c.save()' | jsx kosmos """

        self.info("Check that the client is not existing")
        command = """. /sandbox/env.sh && echo 'print(j.clients.github.get("test_create_client").name)' | jsx kosmos """
        output, error = self.os_command(command)
        self.assertIn('Missing Github token or login/password', output.decode())
        
    def Test05_test_delete_client_for_non_exists_cient(self):
        """
        TC258

        ** Test delete github client for exists client, should fail. **

        #. Delete non exists github user, should fails.
        #. check for error. 
        """

        self.info("Delete non exists github user")
        command = """. /sandbox/env.sh && echo 'c.delete("test_delete_client"); c.save()' | jsx kosmos """

        self.info("Check that the deletion raise an error")
        output, error = self.os_command(command)
        self.assertTrue(error)
    








